<html>
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.css" type="text/css" />

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis-network.min.js"> </script>
	<center>
		<h1></h1>
	</center>

	<!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
    <script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->

	<style type="text/css">

		html, body {
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		table.dreadTable {
			border: 1px solid #CCCCCC;
			text-align: center;
			border-collapse: collapse;
			text-transform: capitalize;
		}
		table.dreadTable td, table.dreadTable th {
			border: 1px solid #AAAAAA;
			padding: 5px 5px;
		}
		table.dreadTable tbody td {
			font-size: 12px;
		}
		table.dreadTable thead {
			background: #EEEEEE;
			background: -moz-linear-gradient(top, #f2f2f2 0%, #efefef 66%, #EEEEEE 100%);
			background: -webkit-linear-gradient(top, #f2f2f2 0%, #efefef 66%, #EEEEEE 100%);
			background: linear-gradient(to bottom, #f2f2f2 0%, #efefef 66%, #EEEEEE 100%);
			border-bottom: 2px solid #444444;
		}
		table.dreadTable thead th {
			font-size: 13px;
			font-weight: bold;
			color: #333333;
			text-align: left;
			border-left: 0px solid #D0E4F5;
		}
		table.dreadTable thead th:first-child {
			border-left: none;
		}

		table.dreadTable tfoot td {
			font-size: 14px;
		}
		table.dreadTable tfoot .links {
			text-align: right;
		}
		table.dreadTable tfoot .links a{
			display: inline-block;
			background: #1C6EA4;
			color: #FFFFFF;
			padding: 2px 8px;
			border-radius: 5px;
		}

		#mynetwork {
		width: 50%;
		height: 100%;
		background-color: #222222;
		border: 1px solid lightgray;
		position: relative;
		float: left;
		z-index: 9999;
		}

		

		
		#config {
			height: 100%;
		}
		

		
	</style>

</head>

<body>
<div>
	<div id = "mynetwork"></div>
	
	<div id = "config" align="center">
		<h3>DREAD Score Calucaltor</h3>
		<table id="dreadTable" class="dreadTable">
			<thead>
			<tr>
				<th>Node Leaf</th>
				<th>Damage</th>
				<th>Reproducibility</th>
				<th>Exploitability</th>
				<th>Affected Users</th>
				<th>Discoverability</th>
			</tr>
			</thead>
			<tbody id="tableID">
			</tbody>
			<tr>
				<td colspan="6">
					<button onclick="calculateRisk()" style="width: 100%">Calculate DREAD score</button>
				</td>
			</tr>
		</table>
	</div>
	
</div>

<script type="text/javascript">

	// initialize global variables.
	var edges;
	var nodes;
	var network;
	var container;
	var options, data;


	// This method is responsible for drawing the graph, returns the drawn network
	function drawGraph() {
		var container = document.getElementById('mynetwork');

		

		// parsing and collecting nodes and edges from the python
		nodes = new vis.DataSet([{"affected_users": 0, "damage": 1, "discoverability": 2, "exploitability": 1, "font": {"color": "white"}, "id": "1", "label": "open safe", "reproducibility": 3, "shape": "box", "title": "open safe"}, {"affected_users": 2, "damage": 1, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "2", "label": "pick lock", "reproducibility": 3, "shape": "box", "title": "pick lock"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "3", "label": "learn combo", "reproducibility": 0, "shape": "box", "title": "learn combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "4", "label": "cut open safe", "reproducibility": 0, "shape": "box", "title": "cut open safe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "5", "label": "install improperly", "reproducibility": 0, "shape": "box", "title": "install improperly"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "6", "label": "find written combo", "reproducibility": 0, "shape": "box", "title": "find written combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "7", "label": "get combo from target", "reproducibility": 0, "shape": "box", "title": "get combo from target"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "8", "label": "threaten", "reproducibility": 0, "shape": "box", "title": "threaten"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "9", "label": "blackmail", "reproducibility": 0, "shape": "box", "title": "blackmail"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "10", "label": "eavesdrop", "reproducibility": 0, "shape": "box", "title": "eavesdrop"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "11", "label": "bribe", "reproducibility": 0, "shape": "box", "title": "bribe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "12", "label": "listen to conversation", "reproducibility": 0, "shape": "box", "title": "listen to conversation"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "13", "label": "get target to state combo", "reproducibility": 0, "shape": "box", "title": "get target to state combo"}]);
		edges = new vis.DataSet([{"from": "1", "to": "2", "value": 1}, {"from": "1", "to": "3", "value": 1}, {"from": "1", "to": "4", "value": 1}, {"from": "1", "to": "5", "value": 1}, {"from": "3", "to": "6", "value": 1}, {"from": "3", "to": "7", "value": 1}, {"from": "7", "to": "8", "value": 1}, {"from": "7", "to": "9", "value": 1}, {"from": "7", "to": "10", "value": 1}, {"from": "7", "to": "11", "value": 1}, {"from": "10", "to": "12", "value": 1}, {"from": "10", "to": "13", "value": 1}]);

		// adding nodes and edges to the graph
		data = {nodes: nodes, edges: edges};

		let nodeLeafs = Object.values(nodes._data)

		nodeLeafs = nodeLeafs.map((item) => {
			return item.title
		})

		var options = {
    "configure": {
        "enabled": false
    }, 
    "edges": {
        "color": {
            "inherit": true
        }, 
        "smooth": {
            "enabled": false, 
            "type": "continuous"
        }
    }, 
    "interaction": {
        "dragNodes": true, 
        "dragView": false, 
        "hideEdgesOnDrag": false, 
        "hideNodesOnDrag": false
    }, 
    "layout": {
        "hierarchical": {
            "blockShifting": true, 
            "direction": "UD", 
            "edgeMinimization": true, 
            "enabled": true, 
            "levelSeparation": 150, 
            "nodeDistance": 180, 
            "parentCentralization": true, 
            "sortMethod": "directed", 
            "treeSpacing": 400
        }, 
        "improvedLayout": true, 
        "randomSeed": 0
    }, 
    "physics": {
        "barnesHut": {
            "avoidOverlap": 0, 
            "centralGravity": 0.3, 
            "damping": 0.09, 
            "gravitationalConstant": -80000, 
            "springConstant": 0.001, 
            "springLength": 250
        }, 
        "enabled": true, 
        "hierarchicalRepulsion": {
            "centralGravity": 0.0, 
            "damping": 0.09, 
            "nodeDistance": 160, 
            "springConstant": 0.01, 
            "springLength": 100
        }, 
        "solver": "hierarchicalRepulsion", 
        "stabilization": {
            "enabled": true, 
            "fit": true, 
            "iterations": 1000, 
            "onlyDynamicEdges": false, 
            "updateInterval": 50
        }
    }
};

		

		
		// if this network requires displaying the configure window,
		// put it in its div
		options.configure["container"] = document.getElementById("config");
		

		network = new vis.Network(container, data, options);

		


		

		return network;

	}

	function calculateRisk() {
		let nodes = new vis.DataSet([{"affected_users": 0, "damage": 1, "discoverability": 2, "exploitability": 1, "font": {"color": "white"}, "id": "1", "label": "open safe", "reproducibility": 3, "shape": "box", "title": "open safe"}, {"affected_users": 2, "damage": 1, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "2", "label": "pick lock", "reproducibility": 3, "shape": "box", "title": "pick lock"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "3", "label": "learn combo", "reproducibility": 0, "shape": "box", "title": "learn combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "4", "label": "cut open safe", "reproducibility": 0, "shape": "box", "title": "cut open safe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "5", "label": "install improperly", "reproducibility": 0, "shape": "box", "title": "install improperly"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "6", "label": "find written combo", "reproducibility": 0, "shape": "box", "title": "find written combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "7", "label": "get combo from target", "reproducibility": 0, "shape": "box", "title": "get combo from target"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "8", "label": "threaten", "reproducibility": 0, "shape": "box", "title": "threaten"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "9", "label": "blackmail", "reproducibility": 0, "shape": "box", "title": "blackmail"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "10", "label": "eavesdrop", "reproducibility": 0, "shape": "box", "title": "eavesdrop"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "11", "label": "bribe", "reproducibility": 0, "shape": "box", "title": "bribe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "12", "label": "listen to conversation", "reproducibility": 0, "shape": "box", "title": "listen to conversation"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "13", "label": "get target to state combo", "reproducibility": 0, "shape": "box", "title": "get target to state combo"}]);
		let nodeLeafs = Object.values(nodes._data)

		nodeLeafs = nodeLeafs.map((item) => {
			return item.title
		})

		let leafsWithScores = []

		nodeLeafs.forEach(function (leaf) {
			let damage = document.getElementById(leaf+':damage').selectedOptions[0].value;
			let reproducibility = document.getElementById(leaf+':reproducibility').selectedOptions[0].value;
			let exploitability = document.getElementById(leaf+':exploitability').selectedOptions[0].value;
			let affected_users = document.getElementById(leaf+':affected_users').selectedOptions[0].value;
			let discoverability = document.getElementById(leaf+':discoverability').selectedOptions[0].value;
			let score = (parseInt(damage) + parseInt(reproducibility) + parseInt(exploitability) + parseInt(affected_users) + parseInt(discoverability)) / 5
			//console.log(leaf + ' DREAD Score: ' + score)

			return leafsWithScores.push({title: leaf, score: score})
		})

		const element = document.getElementById("dreadTable");
		element.remove();

		const table = document.createElement("table");
		table.setAttribute("id", "newTable")
		table.setAttribute("class", "dreadTable")
		const newTable = document.getElementById("config");
		newTable.appendChild(table);

		// Get the app element
		var config = document.querySelector('#newTable');

		// Create markup
		config.innerHTML = `<thead><th>Leaf Node</th><td>DREAD Score</td></thead><tbody>` + leafsWithScores.map(function (leaf) {
			return (`<tr>
				<td>${leaf.title}</td>
				<td>${leaf.score}</td>
				</tr>`)
		}).join('') + '</tbody>';

		console.log(leafsWithScores)
	}

	function drawTable() {
		let nodes = new vis.DataSet([{"affected_users": 0, "damage": 1, "discoverability": 2, "exploitability": 1, "font": {"color": "white"}, "id": "1", "label": "open safe", "reproducibility": 3, "shape": "box", "title": "open safe"}, {"affected_users": 2, "damage": 1, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "2", "label": "pick lock", "reproducibility": 3, "shape": "box", "title": "pick lock"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "3", "label": "learn combo", "reproducibility": 0, "shape": "box", "title": "learn combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "4", "label": "cut open safe", "reproducibility": 0, "shape": "box", "title": "cut open safe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "5", "label": "install improperly", "reproducibility": 0, "shape": "box", "title": "install improperly"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "6", "label": "find written combo", "reproducibility": 0, "shape": "box", "title": "find written combo"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "7", "label": "get combo from target", "reproducibility": 0, "shape": "box", "title": "get combo from target"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "8", "label": "threaten", "reproducibility": 0, "shape": "box", "title": "threaten"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "9", "label": "blackmail", "reproducibility": 0, "shape": "box", "title": "blackmail"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "10", "label": "eavesdrop", "reproducibility": 0, "shape": "box", "title": "eavesdrop"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "11", "label": "bribe", "reproducibility": 0, "shape": "box", "title": "bribe"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "12", "label": "listen to conversation", "reproducibility": 0, "shape": "box", "title": "listen to conversation"}, {"affected_users": 3, "damage": 0, "discoverability": 3, "exploitability": 2, "font": {"color": "white"}, "id": "13", "label": "get target to state combo", "reproducibility": 0, "shape": "box", "title": "get target to state combo"}]);
		let nodeLeafs = Object.values(nodes._data)

		nodeLeafs = nodeLeafs.map((item) => {
			return item.title
		})

		// Get the app element
		var config = document.querySelector('#tableID');

		// Create markup
		config.innerHTML = nodeLeafs.map(function (leaf) {
			return (`<tr>
				<td>${leaf}</td>
				<td>
					<select id="${leaf}:damage">
					  <option value="1">1</option>
					  <option value="2">2</option>
					  <option value="3">3</option>
					  <option value="4">4</option>
					  <option value="5">5</option>
					  <option value="6">6</option>
					  <option value="7">7</option>
					  <option value="8">8</option>
					  <option value="9">9</option>
					  <option value="10">10</option>
					</select>
				</td>
				<td>
					<select id="${leaf}:reproducibility">
					  <option value="1">1</option>
					  <option value="2">2</option>
					  <option value="3">3</option>
					  <option value="4">4</option>
					  <option value="5">5</option>
					  <option value="6">6</option>
					  <option value="7">7</option>
					  <option value="8">8</option>
					  <option value="9">9</option>
					  <option value="10">10</option>
					</select>
				</td>
				<td>
					<select id="${leaf}:exploitability">
					  <option value="1">1</option>
					  <option value="2">2</option>
					  <option value="3">3</option>
					  <option value="4">4</option>
					  <option value="5">5</option>
					  <option value="6">6</option>
					  <option value="7">7</option>
					  <option value="8">8</option>
					  <option value="9">9</option>
					  <option value="10">10</option>
					</select>
				</td>
				<td>
					<select id="${leaf}:affected_users">
					  <option value="1">1</option>
					  <option value="2">2</option>
					  <option value="3">3</option>
					  <option value="4">4</option>
					  <option value="5">5</option>
					  <option value="6">6</option>
					  <option value="7">7</option>
					  <option value="8">8</option>
					  <option value="9">9</option>
					  <option value="10">10</option>
					</select>
				</td>
				<td>
					<select id="${leaf}:discoverability">
					  <option value="1">1</option>
					  <option value="2">2</option>
					  <option value="3">3</option>
					  <option value="4">4</option>
					  <option value="5">5</option>
					  <option value="6">6</option>
					  <option value="7">7</option>
					  <option value="8">8</option>
					  <option value="9">9</option>
					  <option value="10">10</option>
					</select>
				</td>
				</tr>`)
		}).join('');
	}

	drawGraph();
	drawTable();

</script>
</body>
</html>